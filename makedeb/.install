#!/usr/bin/env bash
pre_install() {
	bad_packages="$(dpkg-query --show --showformat '${Package}/${MPR-Package}\n' | grep '^[^/]*/True' | grep -v '^True/True')"

	if [[ "${bad_packages}" != "" ]]; then
		echo
		printf "\033[1;31m[WARNING]\033[0;00m Your system appears to contain MPR packages that Tap is unable to upgrade due to known bugs in previous versions of Tap.\n"
		echo "You'll need to reinstall all affected packages with 'tap install' to fix any issues with upgrading."
		echo
		echo "To find the affected packages, you can use the following command:"
		echo "  dpkg-query --show --showformat '\${Package}/\${MPR-Package}\n' | grep '^[^/]*/True' | grep -v '^True/True' | awk -F '/' '{print \$1}'"
		echo
	fi
}
